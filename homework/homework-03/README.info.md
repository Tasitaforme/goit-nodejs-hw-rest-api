# MongoDB

MongoDB —î –Ω–µ—Ä–µ–ª—è—Ü—ñ–π–Ω–æ—é –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö —Ç–∏–ø—É NoSQL.  
MongoDB –Ω–∞–ª–µ–∂–∏—Ç—å –¥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–æ–≥–æ —Ç–∏–ø—É –±–∞–∑–∏ –¥–∞–Ω–∏—Ö. –¢–æ–±—Ç–æ –∑–∞—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞
–º–æ–¥–µ–ª—ñ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ ‚Äî –æ–±'—î–∫—Ç–∏ –¥–∞–Ω–∏—Ö –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –≤–∏–≥–ª—è–¥—ñ –æ–∫—Ä–µ–º–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ —É
–∫–æ–ª–µ–∫—Ü—ñ—ó.

–ö–æ–ª–µ–∫—Ü—ñ—è (–º–∞—Å–∏–≤ –æ–±'—î–∫—Ç—ñ–≤) ‚Äî —Ü–µ —Å—É–∫—É–ø–Ω—ñ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤, —è–∫—ñ –º–∞—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤–µ
–ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è.  
–î–æ–∫—É–º–µ–Ω—Ç ‚Äì —Ü–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π
—Ä–æ–∑–º—ñ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –æ–±–º–µ–∂–µ–Ω–∏–π 16 –ú–±.

–£ —è–∫–æ—Å—Ç—ñ –º–æ–≤–∏ –∑–∞–ø–∏—Ç—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è JavaScript —Ç–∞ JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏.

–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∞ –≤ —Ö–º–∞—Ä—ñ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –≤ —Ç–µ—Ä–º—ñ–Ω–∞—Ö –∫–æ–º–ø–∞–Ω—ñ—ó ¬´MongoDB¬ª –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è
¬´–∫–ª–∞—Å—Ç–µ—Ä–æ–º¬ª (cluster).

–£ MongoDB –ø–µ—Ä–≤–∏–Ω–Ω–∏–π –∫–ª—é—á –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è —É –ø–æ–ª—ñ \_id.

```js
_id: ObjectId("5f15996fbbde793a107af359");
```

## MongoDB Atlas

–ó–∞–º—ñ—Å—Ç—å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –ª–æ–∫–∞–ª—å–Ω–æ, –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ö–º–∞—Ä–Ω–µ —Å—Ö–æ–≤–∏—â–µ
[MongoDB Atlas](https://www.mongodb.com/atlas/database). –¶–µ –≤–∞—Ä—ñ–∞–Ω—Ç —Å–ª—É–∂–±–∏
MongoDB, —Ä–æ–∑–º—ñ—â–µ–Ω–æ—ó —É —Ö–º–∞—Ä—ñ, —è–∫–∞ –Ω–µ –≤–∏–º–∞–≥–∞—î –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –≤–∏—Ç—Ä–∞—Ç –Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞
–ø—Ä–æ–ø–æ–Ω—É—î –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –¥–ª—è –ø–æ—á–∞—Ç–∫—É —Ä–æ–±–æ—Ç–∏.

1. –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è [MongoDB Atlas](https://account.mongodb.com/account/login)
2. –í–∫–ª–∞–¥–∫–∞ **Projects** -> New project. –í–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤—É –ø—Ä–æ–µ–∫—Ç—É -> Next -> Create
   project
3. –í–∫–ª–∞–¥–∫–∞ **Overview** -> Create a deployment -> Create  
   –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞—Å—Ç–µ—Ä—É (–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –∫–ª–∞—Å—Ç–µ—Ä - 512 MB
   Storage):  
   (cluster - M0, Provider - AWS, Region - Frankfurt, Name - ...)  
    -> Create

4. –í–∫–ª–∞–¥–∫–∞ **Database Access** -> Add New Database User.  
    –í–∏–±—Ä–∞—Ç–∏ –º–µ—Ç–æ–¥ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–∞—Ä–æ–ª—è.  
    –ü—Ä–∏–¥—É–º–∞—Ç–∏ —ñ–º'—è —Ç–∞ –ø–∞—Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ —ñ –∑–∞–ø–∞–º'—è—Ç–∞–π—Ç–∏ (–Ω–∞–¥–∞–ª—ñ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
   —Å–ª—ñ–¥ –ø–æ–º—ñ—Å—Ç–∏—Ç–∏ –≤ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è).  
    –í–∏—Å—Ç–∞–≤–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó –¥–æ—Å—Ç—É–ø—É —è–∫ —á–∏—Ç–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø–∏—Å –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.  
   -> Create User

5. –í–∫–ª–∞–¥–∫–∞ **Network Access** -> Add IP address  
   –î–æ–¥–∞—Ç–∏ IP –∞–¥—Ä–µ—Å–∏ —É —è–∫–∏—Ö –±—É–¥–µ –¥–æ—Å—Ç—É–ø –¥–æ —Ö–º–∞—Ä–Ω–æ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.  
   –Ø–∫ –≤–∞—Ä—ñ–∞–Ω—Ç –º–æ–∂–Ω–∞ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –¥–æ—Å—Ç—É–ø —ñ–∑ –±—É–¥—å-—è–∫–æ—ó IP –∞–¥—Ä–µ—Å–∏ 0.0.0.0/0. –ê–ª–µ –º–æ–∂–Ω–∞
   —ñ –≤–∫–∞–∑–∞—Ç–∏ –ª–∏—à–µ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –∞–¥—Ä–µ—Å–∏.

6. –í–∫–ª–∞–¥–∫–∞ **Database** -> Browse Collections (–º–æ–∂–Ω–∞: Load a Sample Dataset –∞–±–æ
   Add My Own Data)

7. **–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ë–î (MongoDB Compass)** –í–∫–ª–∞–¥–∫–∞ Database -> Cluster: Connect
   -> Compass  
   –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Ä—è–¥–æ–∫ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.  
   –í MongoDB Compass (–≤—Å—Ç–∞–≤–∏—Ç–∏ —Ä—è–¥–æ–∫ —Ç–∞ –¥–æ–ø–∏—Å–∞—Ç–∏ –ø–∞—Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–∏–π
   —Ä–∞–Ω—ñ—à–µ)

8. **–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ë–î (Node.js)**  
   –í–∫–ª–∞–¥–∫–∞ Database -> Cluster: Connect -> Connect your application -> Drivers  
   –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Ä—è–¥–æ–∫ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö:  
   `mongodb+srv://user:<password>@cluster.vviuhr8.mongodb.net/<db>?retryWrites=true&w=majority`  
   –ó–∞–º—ñ–Ω–∏—Ç–∏ `<password>` –Ω–∞ –ø–∞—Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–∏–π —Ä–∞–Ω—ñ—à–µ. –ü—Ä–∏
   –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ Mongoose `<db>` –∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ –Ω–∞–∑–≤—É –ë–î.

–í –ø—Ä–æ–µ–∫—Ç—ñ:

```bash
npm install mongodb
```

**–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ MongoDB –∫—É—Ä—Å–∏:**  
üëâ [Free MongoDB courses](https://learn.mongodb.com/)  
üëâ
[MongoDB Node.js Developer Path](https://learn.mongodb.com/learning-paths/mongodb-nodejs-developer-path)

## –ì—Ä–∞—Ñ—ñ—á–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è MongoDB

### MongoDB Compass

[MongoDB Compass](https://www.mongodb.com/products/tools/compass) ‚Äî –≥—Ä–∞—Ñ—ñ—á–Ω–∏–π
—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è MongoDB –≤—ñ–¥ —Å–∞–º–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó.  
–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ä—è–¥–∫–∞ SRV. –õ—ñ–≤–æ—Ä—É—á –±—É–¥–µ –º–µ–Ω—é
–∑ –Ω–∞—à–∏–º–∏ –±–∞–∑–∞–º–∏ —Ç–∞ –∫–æ–ª–µ–∫—Ü—ñ—è–º–∏. –ü—Ä–∏ –≤–∏–±–æ—Ä—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó –º–∏ –ø–æ—Ç—Ä–∞–ø–ª—è—î–º–æ –¥–æ –ø–∞–Ω–µ–ª—ñ
—É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó. –ó–∞–º—ñ—Å—Ç—å –∫–æ–Ω—Å–æ–ª—ñ Compass –Ω–∞–¥–∞—î –ø–∞–Ω–µ–ª—å –¥–ª—è –ø–æ—à—É–∫—É —Ç–∞
—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –∑–∞ –Ω–∞—à–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏. –Ü –ø–æ–≤–Ω—É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å –∑–∞ CRUD –æ–ø–µ—Ä–∞—Ü—ñ—è–º –Ω–∞–¥
–¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–æ–≤–∏ –∑–∞–ø–∏—Ç—ñ–≤.

### Robo 3T

[Robo 3T](https://robomongo.org/) ‚Äî –≥—Ä–∞—Ñ—ñ—á–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è MongoDB –≤—ñ–¥ 3T
Software. –ú–∞—î –∫—Ä–æ—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–Ω—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É, –∞ —Ç–∞–∫–æ–∂ –≤–±—É–¥–æ–≤—É—î –æ–±–æ–ª–æ–Ω–∫—É mongo —É —Å–≤—ñ–π
—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –≤–∑–∞—î–º–æ–¥—ñ—ó —è–∫ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –æ–±–æ–ª–æ–Ω–∫–∏, —Ç–∞–∫ —ñ –Ω–∞ –æ—Å–Ω–æ–≤—ñ
–≥—Ä–∞—Ñ—ñ—á–Ω–æ–≥–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É.  
–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ä—è–¥–∫–∞ SRV. –î–∞–π—Ç–µ —Å–≤–æ—î–º—É
–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—é —ñ–º'—è, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –ø–æ–ª–µ "from SRV" (—Å–∫–æ–ø—ñ—é–π—Ç–µ —Ä—è–¥–æ–∫ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è, —è–∫–∏–π
–Ω–∞–º –Ω–∞–¥–∞—î MongoDB Atlas), –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å save, –∞ –ø—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–π—Ç–µ connect –¥–æ —Ö–º–∞—Ä–Ω–æ—ó
–±–∞–∑–∏ –¥–∞–Ω–∏—Ö.  
–í–≥–æ—Ä—ñ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∫–æ–Ω—Å–æ–ª—å —ñ–∑ –∑–∞–ø–∏—Ç–∞–º–∏ –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.  
–í–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∫–ª–∞–≤—ñ—à–µ—é F5 —á–∏ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—î—é –∫–ª–∞–≤—ñ—à Ctrl+Enter.

### **–û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ —Ä–æ–±–æ—Ç–∏ –≤ –≥—Ä–∞—Ñ—ñ—á–Ω–∏—Ö —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö:**

üëâ [–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ](/homework/homework-03/interface-basic-commands.md)

# Mongoose

[Mongoose](https://mongoosejs.com/docs/guide.html) ‚Äî —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ ODM-–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞
(Object Data Modelling) –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö MongoDB.  
–ú–æ–¥—É–ª—å —Å–ª—É–∂–∏—Ç—å –∑—Ä—É—á–Ω–∏–º –∑–∞—Å–æ–±–æ–º –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏—Ö —Å—Ö–µ–º –¥–æ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤.
–¢–∞–∫–æ–∂ –¥–∞—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –¥–æ—Å—Ç–æ–≤—ñ—Ä–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∏–ø—ñ–≤ –¥–∞–Ω–∏—Ö —Ç–∞ –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π
–≤–∞–ª—ñ–¥–∞—Ü—ñ—ó.  
Mongoose –ø—Ä–∞—Ü—é—î –∑ –∫–æ–ª–µ–∫—Ü—ñ—î—é MongoDB –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–æ–¥–µ–ª—ñ.

–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏:

```bash
npm install mongoose -S
```

```js
const mongoose = require("mongoose");
mongoose.Promise = global.Promise;
```

–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö:

```js
mongoose.connect(process.env.DB_HOST, {
  useNewUrlParser: true,
  useCreateIndex: true,
  useUnifiedTopology: true,
});
```

–í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤—ñ–¥ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö:

```js
mongoose.disconnect();
```

[Link](https://code.tutsplus.com/uk/an-introduction-to-mongoose-for-mongodb-and-nodejs--cms-29527a):
–í—Å—Ç—É–ø –¥–æ Mongoose –¥–ª—è MongoDB —Ç–∞ Node.js

## –°—Ö–µ–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

–î–∞–Ω—ñ –º–æ–∂–Ω–∞ –æ–ø–∏—Å–∞—Ç–∏ –ø–µ–≤–Ω–æ—é
[—Å—Ö–µ–º–æ—é](https://mongoosejs.com/docs/guide.html#schemas) (–æ–ø–∏—Å –∑–º—ñ—Å—Ç—É, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏
—Ç–∞ –æ–±–º–µ–∂–µ–Ω—å –æ–±'—î–∫—Ç–∞ –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó).  
–°—Ö–µ–º–∞ –º—ñ—Å—Ç–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω—ñ –æ–±'—î–∫—Ç—ñ–≤. –¢—É—Ç –≤–∫–∞–∑—É—î—Ç—å—Å—è, —è–∫—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –±—É–¥–µ –º–∞—Ç–∏
–æ–±'—î–∫—Ç —ñ —è–∫–∏–π –±—É–¥–µ —Ç–∏–ø –¥–∞–Ω–∏—Ö (String, Number, Date, Buffer, Boolean, Mixed,
Objectid, Array).

```js
const Schema = mongoose.Schema;
const dateRegexp = /^\d{2}-\d{2}-\d{4}$/; // 16-10-2009
const genderList = ["male", "female"];
// –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ö–µ–º–∏
const cats = new Schema(
  {
    nickname: {
      type: String,
      minlength: 2,
      maxlength: 7,
      required: [true, "Nickname is required"],
    },
    age: {
      type: Number,
      min: 1,
      max: 50,
    },
    gender: {
      type: String,
      enum: genderList,
      required: true,
    },
    date: {
      type: String,
      match: dateRegexp,
      required: true,
    },
    deletedAt: { type: Date, default: null },
    owner: {
      username: { type: String, required: true },
      email: { type: String, unique: true, required: true },
    },
  },
  { versionKey: false, timestamps: true }
);

// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å—Ö–µ–º—É:
//'cat' - –ø–µ—Ä—à–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä - –Ω–∞–∑–≤–∞ –º–æ–¥–µ–ª—ñ
//cats - –¥—Ä—É–≥–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä - —Å—Ö–µ–º–∞
const Cat = mongoose.model("cat", cats);

// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤ –¥–ª—è —Ü—ñ—î—ó –º–æ–¥–µ–ª—ñ
const cat = new Cat({
  nickname: "Marcus",
  age: 2,
});

// –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
const result = cat.save();
console.log("–ö—ñ—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π —É –±–∞–∑—É! ", result);
```

### [–Ü–Ω–¥–µ–∫—Å–∏](<https://mongoosejs.com/docs/api/schema.html#Schema.prototype.index()>)

–Ø–∫—â–æ –ø–æ–ª–µ —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø—Ä–∏ –ø–æ—à—É–∫—É –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –π–æ–º—É –º–æ–∂–Ω–∞ –ø—Ä–∏–∑–Ω–∞—á–∏—Ç–∏
—ñ–Ω–¥–µ–∫—Å.

### –ú–µ—Ç–æ–¥–∏ —É –æ–±'—î–∫—Ç–∞ —Å—Ö–µ–º–∏

```js
const user = new Schema({
  firstName: String,
  lastName: String,
});

user.methods.fullName = function () {
  return `${this.firstName} ${this.lastName}`;
};
```

### [Validation mongoose](https://mongoosejs.com/docs/validation.html)

**joi** –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Ç—ñ–ª–æ –∑–∞–ø–∏—Ç—É (—â–æ –Ω–∞–º –ø—Ä–∏—Ö–æ–¥–∏—Ç—å);  
**mongoose** –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Ç–µ, —â–æ –º–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö.

–ü—Ä–∏ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—ñ —Å—Ö–µ–º–∏ Mongoose –º–∞—î –≤–±—É–¥–æ–≤–∞–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∫–∞–∑–∞—Ç–∏
—É —Å—Ö–µ–º—ñ:

- **unique**: —Ä–æ–±–∏—Ç—å –ø–æ–ª–µ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º, —Ç–æ–±—Ç–æ –≤ –≤ —ñ–Ω—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –∫–æ–ª–µ–∫—Ü—ñ—ó –Ω–µ
  –º–æ–∂–µ –±—É—Ç–∏ —Ç–∞–∫–æ–≥–æ –ø–æ–ª—è –∑ —Ç–∞–∫–∏–º –∂–µ –∑–Ω–∞—á–µ–Ω–Ω—è–º;
- **required**: –≤–∏–º–∞–≥–∞—î –æ–±–æ–≤'—è–∑–∫–æ–≤–æ—ó –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è —è–∫–æ—Å—Ç—ñ
- **min** —Ç–∞ **max**: –∑–∞–¥–∞—é—Ç—å –º—ñ–Ω—ñ–º–∞–ª—å–Ω–µ —Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è —á–∏—Å–ª–æ–≤–∏—Ö
  –¥–∞–Ω–∏—Ö
- **minlength** —Ç–∞ **maxlength**: –∑–∞–¥–∞—é—Ç—å –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É —Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É –¥–æ–≤–∂–∏–Ω—É –¥–ª—è
  —Ä—è–¥–∫—ñ–≤
- **enum**: —Ä—è–¥–æ–∫ –ø–æ–≤–∏–Ω–µ–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç–∏ –æ–¥–Ω–µ —ñ–∑ –∑–Ω–∞—á–µ–Ω—å —É –∑–∞–∑–Ω–∞—á–µ–Ω–æ–º—É –º–∞—Å–∏–≤—ñ
  —Ä—è–¥–∫—ñ–≤
- **match**: —Ä—è–¥–æ–∫ –ø–æ–≤–∏–Ω–µ–Ω –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–º—É –≤–∏—Ä–∞–∑—É
- `{versionKey: false, timestamps: true}` ‚Äî –≤–∫–∞–∑—É—î —Å—Ö–µ–º—ñ, —â–æ –∑–∞–º—ñ—Å—Ç—å –≤–µ—Ä—Å—ñ—ó
  –æ–±'—î–∫—Ç–∞ –≤ –±–∞–∑—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —á–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ —á–∞—Å –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è.

–ú–µ—Ç–æ–¥–∏ mongoose –≤–∏–∫–∏–¥–∞—é—Ç—å –ø–æ–º–∏–ª–∫—É –±–µ–∑ —Å—Ç–∞—Ç—É—Å—É, –∞ —è–∫—â–æ —Ç–∞–∫ —Ç–æ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
–≤—ñ–¥–ø—Ä–∞–≤–ª—è—î —ó—ó –≤ 500 —Å—Ç–∞—Ç—É—Å. –ê–ª–µ –ø–æ–º–∏–ª–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ü–µ 400 —Å—Ç–∞—Ç—É—Å, —â–æ–± —Ü–µ
–≤–∏–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ —Å—Ö–µ–º–∏ –¥–æ–¥–∞—Ç–∏ middleware

```js
contactSchema.post("save", (error, data, next) => {
  error.status = 400;
  next();
});
```

## –û—Å–Ω–æ–≤–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ –¥–∞–Ω–∏–º–∏ –≤ Mongoose

–ó–∞–ø–∏—Ç–∏ Mongoose –Ω–µ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å "—á–∏—Å—Ç–∏–π –ø—Ä–æ–º—ñ—Å", —Ö–æ—á–∞ –≤ –Ω–∏—Ö —ñ —î `.then()` –º–µ—Ç–æ–¥
–¥–ª—è `async/await`.  
–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —â–æ–± –ø–æ–≤–µ—Ä–Ω—É–≤—Å—è "—á–∏—Å—Ç–∏–π –ø—Ä–æ–º—ñ—Å", —Ç–æ —Å–ª—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏
[.exec()](https://mongoosejs.com/docs/queries.html#executing)

```js
const books = await Book.find().exec();
```

### **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤:**

–Ü—Å–Ω—É—î –¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –¥–æ–¥–∞—Ç–∏ –æ–±'—î–∫—Ç –≤ –∫–æ–ª–µ–∫—Ü—ñ—é:

1. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–µ—Ç–æ–¥—É `save()` –≤—ñ–¥ –æ–±'—î–∫—Ç–∞
   ([The active record pattern](https://blog.savetchuk.com/overview-of-the-active-record-pattern)):

```js
// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ (–æ–±'—î–∫—Ç–∞) –¥–ª—è –º–æ–¥–µ–ª—ñ
const cat = new Cat({
  nickname: "Marcus",
  age: 2,
});
// –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
const result = cat.save();
```

2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–µ—Ç–æ–¥—É `create()` –≤—ñ–¥ –º–æ–¥–µ–ª—ñ –æ–±'—î–∫—Ç–∞:

```js
Cat.create({
  nickname: "Barsik",
  age: 1,
});
```

### **–û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö:**

_find_ ‚Äî –ø–æ—à—É–∫, —è–∫–∏–π –ø–æ–≤–µ—Ä—Ç–∞—î –º–∞—Å–∏–≤ –æ–±'—î–∫—Ç—ñ–≤ —Ç–∏–ø—É Document, —è–∫—ñ –∑–±—ñ–≥–∞—é—Ç—å—Å—è —ñ–∑
–∑–∞–ø–∏—Ç–æ–º;  
_findOne_ ‚Äî –ø–æ—à—É–∫ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞, —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î –ø–µ—Ä—à–∏–π –æ–±'—î–∫—Ç Document, —è–∫–∏–π
–∑–±—ñ–≥–∞—î—Ç—å—Å—è —ñ–∑ –∑–∞–ø–∏—Ç–æ–º;  
_findById_ ‚Äî –ø–æ—à—É–∫ —É –∫–æ–ª–µ–∫—Ü—ñ—ó –æ–±'—î–∫—Ç–∞ –∑ –ø–µ–≤–Ω–∏–º Id

```js
find([query], [options]);
// –Ω–∞–ø—Ä–∏–∫–ª–∞–¥
const result = await Book.findOne({ _id: id });
// –∞–±–æ
const result = await Book.findById(id, {
  new: true,
});
```

### **–í–∏–¥–∞–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:**

_remove_ ‚Äî –≤–∏–¥–∞–ª–µ–Ω–Ω—è, –ø—ñ–¥ —á–∞—Å —è–∫–æ–≥–æ –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –≤—Å—ñ –æ–±'—î–∫—Ç–∏, —â–æ
–∑–±—ñ–≥–∞—é—Ç—å—Å—è —ñ–∑ –∑–∞–ø–∏—Ç–æ–º;  
_findOneAndDelete_ ‚Äî –ø–æ—à—É–∫ —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è, –ø—ñ–¥ —á–∞—Å —è–∫–∏—Ö –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è
–ª–∏—à–µ –ø–µ—Ä—à–∏–π –¥–æ–∫—É–º–µ–Ω—Ç, —â–æ –∑–±—ñ–≥–∞—î—Ç—å—Å—è —ñ–∑ –∑–∞–ø–∏—Ç–æ–º;  
_findByIdAndDelete_ ‚Äî –ø–æ—à—É–∫ —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —É –∫–æ–ª–µ–∫—Ü—ñ—ó –æ–±'—î–∫—Ç–∞ –∑ –ø–µ–≤–Ω–∏–º Id;

```js
remove([query], [options]);
```

### **–ó–º—ñ–Ω–∞ –¥–∞–Ω–∏—Ö:**

_update_ ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, –ø—ñ–¥ —á–∞—Å —è–∫–æ–≥–æ –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –≤—Å—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏, —â–æ
–∑–±—ñ–≥–∞—é—Ç—å—Å—è —ñ–∑ –∑–∞–ø–∏—Ç–æ–º;  
_findOneAndUpdate_ ‚Äî –ø–æ—à—É–∫ —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, –ø—ñ–¥ —á–∞—Å —è–∫–∏—Ö –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è
–ª–∏—à–µ –ø–µ—Ä—à–∏–π –¥–æ–∫—É–º–µ–Ω—Ç, —â–æ –∑–±—ñ–≥–∞—î—Ç—å—Å—è —ñ–∑ –∑–∞–ø–∏—Ç–æ–º; _findByIdAndUpdate_ ‚Äî –ø–æ—à—É–∫ —Ç–∞
–æ–Ω–æ–≤–ª–µ–Ω–Ω—è —É –∫–æ–ª–µ–∫—Ü—ñ—ó –æ–±'—î–∫—Ç–∞ –∑ –ø–µ–≤–Ω–∏–º Id.  
–ü–æ–≤–µ—Ä—Ç–∞—î –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–∏–π –æ–±'—î–∫—Ç —ñ–∑ –∫–æ–ª–µ–∫—Ü—ñ—ó (—â–æ–± –∑–º—ñ–Ω–∏—Ç–∏ —Ü–µ ‚Äî
–ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–ø–∏—Å–∞—Ç–∏: `{ returnOriginal: false }` –∞–±–æ `{new: true}`).

```js
update([query], [update], [options]);

const result = await Contact.findByIdAndUpdate(id, req.body, {
  new: true,
});
```

## –ó–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è

–¶–µ –ª–æ–∫–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ, —è–∫—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ –Ω–∞—à–æ–º—É –¥–æ–¥–∞—Ç–∫—É. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ü–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö
–≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–æ–¥—É–ª—è `dotenv`. –¶–µ–π –º–æ–¥—É–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –∑–º—ñ–Ω–Ω—ñ
—Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –∑ —Ñ–∞–π–ª—É `.env`, —è–∫–∏–π —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ —É –∫–æ—Ä–µ–Ω–µ–≤–æ–º—É –∫–∞—Ç–∞–ª–æ–∑—ñ
–ø—Ä–æ–≥—Ä–∞–º–∏.  
–ü—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –º–æ–¥—É–ª—å —É –¥–æ–¥–∞—Ç–∫—É —ñ –≤—ñ–Ω –¥–æ–¥–∞—î –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è –≤ –≥–ª–æ–±–∞–ª—å–Ω–∏–π
–æ–±'—î–∫—Ç `process.env` (—â–æ –º—ñ—Å—Ç–∏—Ç—å –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä–∞, –Ω–∞ —è–∫–æ–º—É –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è
–∫–æ–¥), —ñ –≤–∂–µ –∑–≤—ñ–¥—Ç–∏, –Ω–µ –ø–æ–∫–∞–∑—É—é—á–∏ –∑–Ω–∞—á–µ–Ω–Ω—è —Ü–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö, –º–æ–∂–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ó—Ö
—É –¥–æ–¥–∞—Ç–∫—É.

> –û–ë–û–í'–Ø–ó–ö–û–í–û —Ñ–∞–π–ª `.env` –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ –¥–æ —Ñ–∞–π–ª—É `.gitignore`.  
> –î–û–î–ê–¢–ö–û–í–û –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª `.env.example` —ñ –≤ –Ω—å–æ–º—É –≤–∫–∞–∑–∞—Ç–∏, —è–∫—ñ —ñ—Å–Ω—É—é—Ç—å
> –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è.

```bash
npm install dotenv -D
```

```js
// .env —Ñ–∞–π–ª
DB_HOST = 123456;
NODE_ENV = development;

// .env.example —Ñ–∞–π–ª
DB_HOST =...
NODE_ENV =...

// app.js —Ñ–∞–π–ª
require("dotenv").config();

process.env.DB_HOST;
process.env.NODE_ENV;
```

–ù–∞–¥–∞–ª—ñ –∑–∞–≤–∂–¥–∏ —Å–ª—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Å–µ–∫—Ä–µ—Ç–Ω–∏—Ö
–¥–∞–Ω–∏—Ö, —Ç–∞–∫–∏—Ö —è–∫ —Å–µ–∫—Ä–µ—Ç–Ω—ñ —Å–ª–æ–≤–∞ –¥–ª—è cookie –∞–±–æ jwt, url –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
—Ç–∞ —ñ–Ω—à–µ.

–ü–æ—á–∏–Ω–∞—é—á–∏ –∑ 20.6.0 –≤–µ—Ä—Å—ñ—ó Node.js –º–æ–¥—É–ª—å `dotenv`
[–≤–∂–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω](https://nodejs.org/en/blog/release/v20.6.0):

```bash
node --env-file=config.env index.js
# –∞–±–æ
node --env-file .env index.js
```

```js
// .env —Ñ–∞–π–ª
MESSAGE = HELLO!!!;

// app.js —Ñ–∞–π–ª
console.log(process.env["MESSAGE"]);
```

–ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏
[command line option](https://www.npmjs.com/package/dotenv#preload) –¥–ª—è
–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è dotenv:

```js
$ node -r dotenv/config your_script.js
```

## Render

[Render.com](https://render.com/)  
–ö—Ä–∞—â–µ —Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å –æ–¥—Ä–∞–∑—É —á–µ—Ä–µ–∑ github.  
deploy –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∑ github  
New+ -> Web Service -> Build and deploy from Git repository -> Next  
–í–∏–±–∏—Ä–∞—î–º–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π -> Connect  
–í–≤–æ–¥–∏–º–æ –¥–∞–Ω—ñ:  
**Name**: hw-rest-api-contacts  
**Region**: Frankfurt(EU Central) - –≤–∏–±–∏—Ä–∞—î–º–æ –Ω–∞–π–±–ª–∏–∂—á–∏–π —Ä–µ–≥—ñ–æ–Ω  
**Branch**: main (–∞–±–æ —ñ–Ω—à–∞ –≥—ñ–ª–∫–∞)  
**Root Directory**: —è–∫—â–æ –Ω–µ –≤ –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É  
**Runtime**: Node Build  
**Command**: yarn -> npm i  
**Start Command**: yarn start -> npm start

**Advanced** -> Add Environment Variable (key, value)  
-> Create Web Service

–ü–æ–ø–µ—Ä–µ–¥–Ω—å–æ —Å–ª—ñ–¥ –ø—Ä–æ–ø–∏—Å–∞—Ç–∏ –≤ —Ñ–∞–π–ª—ñ `package.json` –≤–µ—Ä—Å—ñ—é Node:

```js
"engines": {
    "node": "^18.*",
    "npm": "^9.*"
  },
```

[–ê–±–æ —Å–ª—ñ–¥—É–≤–∞—Ç–∏ —Ü—ñ—î—é —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—î—é](https://render.com/docs/node-version)
